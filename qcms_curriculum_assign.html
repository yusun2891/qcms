<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QCMS - 커리큘럼 배정</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-blue: #4C55EB;
      --primary-blue-hover: #3D45D9;
      --primary-blue-light: #EEF0FF;
      --font-1: #191F28;
      --font-2: #4E5968;
      --font-3: #8B95A1;
      --font-4: #B0B8C1;
      --bg-f9: #F9FAFB;
      --bg-f6: #F6F7F9;
      --bg-f3: #F3F4F6;
      --line-e: #E5E8EB;
      --line-d: #D1D6DB;
      --white: #FFFFFF;
      --success: #22C55E;
      --warning: #F59E0B;
      --error: #EF4444;
      
      --gnb-width-expanded: 224px;
      --gnb-width-collapsed: 56px;
      --transition-fast: 0.15s ease;
      --transition-normal: 0.25s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-f6);
      color: var(--font-1);
      height: 100vh;
      overflow: hidden;
    }

    /* GNB */
    .gnb {
      position: fixed;
      left: 0;
      top: 0;
      width: var(--gnb-width-expanded);
      height: 100vh;
      background: var(--white);
      border-right: 1px solid var(--line-e);
      display: flex;
      flex-direction: column;
      transition: width var(--transition-normal);
      z-index: 100;
    }

    .gnb.collapsed {
      width: var(--gnb-width-collapsed);
    }

    .gnb-header {
      height: 56px;
      padding: 0 16px;
      display: flex;
      align-items: center;
      flex-shrink: 0;
      cursor: pointer;
      transition: background var(--transition-fast);
    }

    .gnb-header:hover {
      background: var(--bg-f9);
    }

    .gnb-logo {
      display: flex;
      align-items: center;
      opacity: 1;
      transition: opacity var(--transition-fast);
    }

    .gnb.collapsed .gnb-logo {
      opacity: 0;
      position: absolute;
      pointer-events: none;
    }

    .gnb-logo-text {
      font-size: 18px;
      font-weight: 700;
      white-space: nowrap;
    }

    .gnb-logo-text span:first-child {
      color: var(--primary-blue);
    }

    .gnb-logo-text span:last-child {
      color: var(--font-1);
    }

    .gnb-hamburger {
      width: 24px;
      height: 24px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 4px;
      opacity: 0;
      position: absolute;
      pointer-events: none;
      transition: opacity var(--transition-fast);
    }

    .gnb.collapsed .gnb-hamburger {
      opacity: 1;
      position: relative;
      pointer-events: auto;
    }

    .gnb-hamburger span {
      display: block;
      width: 18px;
      height: 2px;
      background: var(--font-1);
      border-radius: 1px;
    }

    .gnb-nav {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 8px 0;
    }

    .gnb-nav::-webkit-scrollbar {
      width: 4px;
    }

    .gnb-nav::-webkit-scrollbar-track {
      background: transparent;
    }

    .gnb-nav::-webkit-scrollbar-thumb {
      background: var(--line-d);
      border-radius: 2px;
    }

    .menu-group {
      margin-bottom: 4px;
      position: relative;
    }

    .menu-group-header {
      display: flex;
      align-items: center;
      padding: 10px 16px;
      cursor: pointer;
      transition: background var(--transition-fast);
      position: relative;
    }

    .menu-group-header:hover {
      background: var(--bg-f9);
    }

    .menu-group-header.active {
      background: var(--bg-f3);
    }

    .menu-icon {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .menu-icon svg {
      width: 20px;
      height: 20px;
      color: var(--font-2);
      transition: color var(--transition-fast);
    }

    .menu-group-header:hover .menu-icon svg,
    .menu-group-header.active .menu-icon svg {
      color: var(--primary-blue);
    }

    .menu-group-title {
      margin-left: 12px;
      font-size: 14px;
      font-weight: 500;
      color: var(--font-1);
      white-space: nowrap;
      flex: 1;
      opacity: 1;
      transition: opacity var(--transition-fast);
    }

    .gnb.collapsed .menu-group-title {
      opacity: 0;
    }

    .menu-arrow {
      width: 16px;
      height: 16px;
      transition: transform var(--transition-fast), opacity var(--transition-fast);
    }

    .menu-arrow svg {
      width: 16px;
      height: 16px;
      color: var(--font-3);
    }

    .gnb.collapsed .menu-arrow {
      opacity: 0;
    }

    .menu-group.open .menu-arrow {
      transform: rotate(180deg);
    }

    .submenu {
      max-height: 0;
      overflow: hidden;
      transition: max-height var(--transition-normal);
    }

    .menu-group.open .submenu {
      max-height: 500px;
    }

    .gnb.collapsed .submenu {
      max-height: 0 !important;
    }

    .submenu-item {
      display: flex;
      align-items: center;
      padding: 8px 16px 8px 52px;
      cursor: pointer;
      transition: background var(--transition-fast);
      text-decoration: none;
    }

    .submenu-item:hover {
      background: var(--bg-f9);
    }

    .submenu-item.active {
      background: var(--bg-f3);
    }

    .submenu-item-text {
      font-size: 13px;
      color: var(--font-2);
      white-space: nowrap;
    }

    .submenu-item.active .submenu-item-text {
      color: var(--primary-blue);
      font-weight: 500;
    }

    /* Floating Submenu */
    .floating-submenu {
      position: fixed;
      background: var(--white);
      border: 1px solid var(--line-e);
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
      padding: 8px 0;
      min-width: 180px;
      z-index: 150;
      opacity: 0;
      visibility: hidden;
      transform: translateX(-8px);
      transition: all var(--transition-fast);
    }

    .floating-submenu.visible {
      opacity: 1;
      visibility: visible;
      transform: translateX(0);
    }

    .floating-submenu-title {
      padding: 8px 16px;
      font-size: 12px;
      font-weight: 600;
      color: var(--font-3);
      border-bottom: 1px solid var(--line-e);
      margin-bottom: 4px;
    }

    .floating-item {
      display: flex;
      align-items: center;
      padding: 8px 16px;
      cursor: pointer;
      transition: background var(--transition-fast);
      text-decoration: none;
    }

    .floating-item:hover {
      background: var(--bg-f9);
    }

    .floating-item.active {
      background: var(--bg-f3);
    }

    .floating-item-text {
      font-size: 13px;
      color: var(--font-2);
    }

    .floating-item.active .floating-item-text {
      color: var(--primary-blue);
      font-weight: 500;
    }

    /* Main Content */
    .main-wrapper {
      margin-left: var(--gnb-width-expanded);
      height: 100vh;
      display: flex;
      flex-direction: column;
      transition: margin-left var(--transition-normal);
    }

    .gnb.collapsed ~ .main-wrapper {
      margin-left: var(--gnb-width-collapsed);
    }

    .fixed-header {
      flex-shrink: 0;
      background: var(--bg-f6);
      padding: 16px 24px 0 24px;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .page-header-left {
      display: flex;
      align-items: baseline;
      gap: 12px;
    }

    .page-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--font-1);
    }

    .page-description {
      font-size: 13px;
      color: var(--font-3);
    }

    /* Content Card */
    .content-card {
      flex: 1;
      margin: 0 24px 24px 24px;
      background: var(--white);
      border-radius: 12px;
      border: 1px solid var(--line-e);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Toolbar */
    .toolbar {
      padding: 16px 20px;
      border-bottom: 1px solid var(--line-e);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .filter-section {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .search-box {
      position: relative;
      width: 280px;
    }

    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      color: var(--font-3);
    }

    .search-input {
      width: 100%;
      height: 36px;
      padding: 0 12px 0 36px;
      border: 1px solid var(--line-e);
      border-radius: 8px;
      font-size: 13px;
      color: var(--font-1);
      transition: border-color var(--transition-fast);
    }

    .search-input::placeholder {
      color: var(--font-4);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary-blue);
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-label {
      font-size: 13px;
      color: var(--font-3);
      white-space: nowrap;
    }

    .filter-select {
      height: 36px;
      padding: 0 32px 0 12px;
      border: 1px solid var(--line-e);
      border-radius: 8px;
      font-size: 13px;
      color: var(--font-1);
      background: var(--white) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%238B95A1' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E") no-repeat right 10px center;
      appearance: none;
      cursor: pointer;
      min-width: 130px;
    }

    .filter-select:focus {
      outline: none;
      border-color: var(--primary-blue);
    }

    /* Multi-select Dropdown */
    .multi-select {
      position: relative;
      min-width: 130px;
    }

    .multi-select-trigger {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 36px;
      padding: 0 10px 0 12px;
      border: 1px solid var(--line-e);
      border-radius: 8px;
      font-size: 13px;
      color: var(--font-1);
      background: var(--white);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .multi-select-trigger:hover {
      border-color: var(--line-d);
    }

    .multi-select.open .multi-select-trigger {
      border-color: var(--primary-blue);
    }

    .multi-select-trigger svg {
      width: 12px;
      height: 12px;
      color: var(--font-3);
      transition: transform var(--transition-fast);
    }

    .multi-select.open .multi-select-trigger svg {
      transform: rotate(180deg);
    }

    .multi-select-dropdown {
      display: none;
      position: absolute;
      top: calc(100% + 4px);
      left: 0;
      min-width: 100%;
      max-height: 240px;
      overflow-y: auto;
      background: var(--white);
      border: 1px solid var(--line-e);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      z-index: 50;
    }

    .multi-select.open .multi-select-dropdown {
      display: block;
    }

    .multi-select-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      cursor: pointer;
      transition: background var(--transition-fast);
    }

    .multi-select-option:hover {
      background: var(--bg-f9);
    }

    .multi-select-option input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: var(--primary-blue);
      cursor: pointer;
    }

    .multi-select-option span {
      font-size: 13px;
      color: var(--font-1);
    }

    .multi-select-text {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100px;
    }

    .multi-select-text.has-selection {
      color: var(--primary-blue);
      font-weight: 500;
    }

    .action-section {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .selected-count {
      font-size: 13px;
      color: var(--font-3);
    }

    .selected-count strong {
      color: var(--primary-blue);
      font-weight: 600;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      height: 36px;
      padding: 0 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
      border: none;
      white-space: nowrap;
    }

    .btn svg {
      width: 16px;
      height: 16px;
    }

    .btn-primary {
      background: var(--primary-blue);
      color: var(--white);
    }

    .btn-primary:hover {
      background: var(--primary-blue-hover);
    }

    .btn-primary:disabled {
      background: var(--line-d);
      cursor: not-allowed;
    }

    .btn-secondary {
      background: var(--white);
      color: var(--font-2);
      border: 1px solid var(--line-e);
    }

    .btn-secondary:hover {
      background: var(--bg-f9);
    }

    /* Table */
    .table-wrapper {
      flex: 1;
      overflow: auto;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    .data-table thead {
      position: sticky;
      top: 0;
      z-index: 10;
      background: var(--bg-f9);
    }

    .data-table th {
      padding: 12px 16px;
      text-align: left;
      font-size: 12px;
      font-weight: 600;
      color: var(--font-3);
      border-bottom: 1px solid var(--line-e);
      white-space: nowrap;
    }

    .data-table td {
      padding: 14px 16px;
      font-size: 13px;
      color: var(--font-2);
      border-bottom: 1px solid var(--line-e);
      vertical-align: middle;
    }

    .data-table tbody tr:hover {
      background: var(--bg-f9);
    }

    .data-table tbody tr.clickable {
      cursor: pointer;
    }

    /* Column widths */
    .col-checkbox { width: 48px; text-align: center; }
    .col-quarter { width: 110px; }
    .col-brand { width: 90px; }
    .col-grade { width: 60px; text-align: center; }
    .col-level { width: 100px; }
    .col-circular { width: auto; min-width: 180px; }
    .col-retention { width: auto; min-width: 180px; }
    .col-modified { width: 130px; }
    .col-created { width: 130px; }
    .col-action { width: 120px; text-align: center; }

    /* Checkbox */
    .checkbox-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .checkbox-wrapper input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: var(--primary-blue);
    }

    /* Textbook badges */
    .textbook-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      pointer-events: none;
    }

    .textbook-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      background: var(--bg-f3);
      border-radius: 4px;
      font-size: 12px;
      color: var(--font-2);
      pointer-events: none;
    }

    .textbook-badge.assigned {
      background: #DCFCE7;
      color: #166534;
    }

    .textbook-badge svg {
      width: 14px;
      height: 14px;
      color: var(--success);
    }

    .textbook-badge.unassigned {
      background: var(--bg-f3);
      color: var(--font-4);
    }

    /* Exception row */
    .exception-row td {
      background: var(--bg-f9);
    }

    .exception-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      padding-left: 24px;
      color: var(--warning);
      font-size: 12px;
      pointer-events: none;
    }

    .exception-indicator svg {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    .exception-campus {
      font-weight: 500;
      color: var(--font-2);
    }

    /* Action buttons */
    .btn-exception {
      padding: 6px 10px;
      font-size: 12px;
      background: var(--white);
      color: var(--primary-blue);
      border: 1px solid var(--primary-blue);
      border-radius: 6px;
      cursor: pointer;
      transition: all var(--transition-fast);
      white-space: nowrap;
    }

    .btn-exception:hover {
      background: var(--primary-blue-light);
    }

    .btn-delete {
      padding: 6px 16px;
      font-size: 12px;
      background: var(--white);
      color: var(--error);
      border: 1px solid var(--error);
      border-radius: 6px;
      cursor: pointer;
      transition: all var(--transition-fast);
      white-space: nowrap;
    }

    .btn-delete:hover {
      background: #FEE2E2;
    }

    /* Pagination */
    .pagination-wrapper {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 20px;
      border-top: 1px solid var(--line-e);
      background: var(--white);
      flex-shrink: 0;
    }

    .pagination-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .pagination-info span {
      font-size: 12px;
      color: var(--font-2);
    }

    .page-size-select {
      height: 28px;
      padding: 0 24px 0 8px;
      border: 1px solid var(--line-d);
      border-radius: 4px;
      font-size: 12px;
      color: var(--font-1);
      background: var(--white) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%238B95A1' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E") no-repeat right 6px center;
      appearance: none;
      cursor: pointer;
    }

    .pagination-pages {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .page-btn {
      min-width: 28px;
      height: 28px;
      padding: 0 6px;
      border: 1px solid var(--line-d);
      border-radius: 4px;
      background: var(--white);
      font-size: 12px;
      color: var(--font-2);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .page-btn:hover {
      background: var(--bg-f9);
      border-color: var(--font-3);
    }

    .page-btn.active {
      background: var(--primary-blue);
      border-color: var(--primary-blue);
      color: var(--white);
    }

    .page-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .page-btn svg {
      width: 14px;
      height: 14px;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 32px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: #1F2937;
      color: white;
      padding: 14px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 2000;
      opacity: 0;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    .toast-icon {
      width: 20px;
      height: 20px;
      color: #10B981;
    }

    /* Modal Overlay */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.show {
      display: flex;
    }

    /* Modal */
    .modal {
      background: var(--white);
      border-radius: 12px;
      width: 700px;
      max-height: 85vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--line-e);
      flex-shrink: 0;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      background: none;
      cursor: pointer;
      border-radius: 6px;
      color: var(--font-3);
    }

    .modal-close:hover {
      background: var(--bg-f3);
    }

    .modal-body {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      padding: 16px 24px;
      border-top: 1px solid var(--line-e);
      flex-shrink: 0;
    }

    .modal-btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .modal-btn-cancel {
      background: var(--white);
      border: 1px solid var(--line-e);
      color: var(--font-2);
    }

    .modal-btn-cancel:hover {
      background: var(--bg-f3);
    }

    .modal-btn-confirm {
      background: var(--primary-blue);
      border: none;
      color: var(--white);
    }

    .modal-btn-confirm:hover {
      background: var(--primary-blue-hover);
    }

    .modal-btn-confirm:disabled {
      background: var(--line-d);
      cursor: not-allowed;
    }

    .modal-btn-danger {
      background: var(--error);
      border: none;
      color: var(--white);
    }

    .modal-btn-danger:hover {
      background: #DC2626;
    }

    /* Course Section in Modal */
    .course-section {
      margin-bottom: 24px;
    }

    .course-section:last-child {
      margin-bottom: 0;
    }

    .course-section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .course-badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
    }

    .course-badge.circular {
      background: #DBEAFE;
      color: #1D4ED8;
    }

    .course-badge.retention {
      background: #FEF3C7;
      color: #B45309;
    }

    .course-required {
      font-size: 12px;
      color: var(--font-3);
    }

    .course-required .required {
      color: var(--error);
    }

    /* Search in Modal */
    .modal-search-wrapper {
      position: relative;
      margin-bottom: 12px;
    }

    .modal-search-input {
      width: 100%;
      padding: 10px 12px 10px 36px;
      border: 1px solid var(--line-e);
      border-radius: 8px;
      font-size: 13px;
    }

    .modal-search-input:focus {
      outline: none;
      border-color: var(--primary-blue);
    }

    .modal-search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--font-4);
    }

    /* Textbook Selection List */
    .textbook-selection-list {
      border: 1px solid var(--line-e);
      border-radius: 8px;
      max-height: 200px;
      overflow-y: auto;
    }

    .textbook-selection-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-bottom: 1px solid var(--line-e);
      cursor: pointer;
      transition: background var(--transition-fast);
    }

    .textbook-selection-item:last-child {
      border-bottom: none;
    }

    .textbook-selection-item:hover {
      background: var(--bg-f9);
    }

    .textbook-selection-item.selected {
      background: var(--primary-blue-light);
    }

    .textbook-selection-item input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: var(--primary-blue);
    }

    .textbook-info {
      flex: 1;
    }

    .textbook-name {
      font-size: 13px;
      font-weight: 500;
      color: var(--font-1);
    }

    .textbook-meta {
      font-size: 11px;
      color: var(--font-4);
      margin-top: 2px;
    }

    /* Selected textbooks display */
    .selected-textbooks {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
      min-height: 32px;
    }

    .selected-textbook-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      background: var(--primary-blue-light);
      border-radius: 6px;
      font-size: 12px;
      color: var(--primary-blue);
    }

    .selected-textbook-tag button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      border: none;
      background: none;
      cursor: pointer;
      color: var(--primary-blue);
      border-radius: 50%;
    }

    .selected-textbook-tag button:hover {
      background: rgba(76, 85, 235, 0.2);
    }

    .no-selection {
      font-size: 12px;
      color: var(--font-4);
      padding: 8px 0;
    }

    /* Alert Modal */
    .alert-modal {
      width: 420px;
    }

    .alert-icon {
      width: 48px;
      height: 48px;
      margin: 0 auto 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .alert-icon.warning {
      background: #FEF3C7;
      color: var(--warning);
    }

    .alert-icon.danger {
      background: #FEE2E2;
      color: var(--error);
    }

    .alert-icon svg {
      width: 24px;
      height: 24px;
    }

    .alert-title {
      font-size: 16px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 8px;
    }

    .alert-message {
      font-size: 14px;
      color: var(--font-3);
      text-align: center;
      line-height: 1.6;
    }

    .alert-footer {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 24px;
    }

    /* Exception Campus Modal */
    .campus-selection-list {
      border: 1px solid var(--line-e);
      border-radius: 8px;
      max-height: 300px;
      overflow-y: auto;
    }

    .campus-selection-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-bottom: 1px solid var(--line-e);
      cursor: pointer;
      transition: background var(--transition-fast);
    }

    .campus-selection-item:last-child {
      border-bottom: none;
    }

    .campus-selection-item:hover {
      background: var(--bg-f9);
    }

    .campus-selection-item.selected {
      background: var(--primary-blue-light);
    }

    .campus-name {
      font-size: 13px;
      color: var(--font-1);
      flex: 1;
    }

    .exception-badge {
      font-size: 11px;
      padding: 2px 6px;
      background: #FEF3C7;
      color: #B45309;
      border-radius: 4px;
      font-weight: 500;
    }

    /* Target info in modal */
    .target-info {
      background: var(--bg-f9);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    }

    .target-info-title {
      font-size: 12px;
      color: var(--font-3);
      margin-bottom: 8px;
    }

    .target-info-content {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .target-tag {
      display: inline-flex;
      padding: 4px 10px;
      background: var(--white);
      border: 1px solid var(--line-e);
      border-radius: 4px;
      font-size: 12px;
      color: var(--font-2);
    }
  </style>
</head>
<body>
  <!-- GNB -->
  <nav class="gnb" id="gnb">
    <div class="gnb-header" id="gnbHeader">
      <div class="gnb-logo">
        <div class="gnb-logo-text">
          <span>Q</span><span>CMS</span>
        </div>
      </div>
      <div class="gnb-hamburger">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>

    <div class="gnb-nav">
      <!-- 커리큘럼 관리 -->
      <div class="menu-group open" data-menu="curriculum">
        <div class="menu-group-header active">
          <div class="menu-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
              <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg>
          </div>
          <span class="menu-group-title">커리큘럼 관리</span>
          <div class="menu-arrow">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
        </div>
        <div class="submenu">
          <a class="submenu-item" href="#" data-page="quarter-settings">
            <span class="submenu-item-text">분기 설정</span>
          </a>
          <a class="submenu-item" href="#" data-page="textbook-register">
            <span class="submenu-item-text">교재 등록</span>
          </a>
          <a class="submenu-item active" href="#" data-page="curriculum-assign">
            <span class="submenu-item-text">커리큘럼 배정</span>
          </a>
        </div>
      </div>

      <!-- 콘텐츠 관리 -->
      <div class="menu-group" data-menu="contents">
        <div class="menu-group-header">
          <div class="menu-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
              <polyline points="2 17 12 22 22 17"></polyline>
              <polyline points="2 12 12 17 22 12"></polyline>
            </svg>
          </div>
          <span class="menu-group-title">콘텐츠 관리</span>
          <div class="menu-arrow">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
        </div>
        <div class="submenu">
          <a class="submenu-item" href="#" data-page="circular-course">
            <span class="submenu-item-text">Circular Course</span>
          </a>
          <a class="submenu-item" href="#" data-page="retention-course">
            <span class="submenu-item-text">Retention Course</span>
          </a>
        </div>
      </div>

      <!-- Prompt 관리 -->
      <div class="menu-group" data-menu="prompt">
        <div class="menu-group-header">
          <div class="menu-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="4 17 10 11 4 5"></polyline>
              <line x1="12" y1="19" x2="20" y2="19"></line>
            </svg>
          </div>
          <span class="menu-group-title">Prompt 관리</span>
          <div class="menu-arrow">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
        </div>
        <div class="submenu">
          <a class="submenu-item" href="#" data-page="content-prompt">
            <span class="submenu-item-text">콘텐츠 생성 Prompt</span>
          </a>
          <a class="submenu-item" href="#" data-page="module-prompt">
            <span class="submenu-item-text">학습 모듈 Prompt</span>
          </a>
        </div>
      </div>

      <!-- 이용 현황 -->
      <div class="menu-group" data-menu="usage">
        <div class="menu-group-header">
          <div class="menu-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="20" x2="18" y2="10"></line>
              <line x1="12" y1="20" x2="12" y2="4"></line>
              <line x1="6" y1="20" x2="6" y2="14"></line>
            </svg>
          </div>
          <span class="menu-group-title">이용 현황</span>
          <div class="menu-arrow">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
        </div>
        <div class="submenu">
          <a class="submenu-item" href="#" data-page="teacher-status">
            <span class="submenu-item-text">선생님 현황</span>
          </a>
          <a class="submenu-item" href="#" data-page="student-status">
            <span class="submenu-item-text">학생 현황</span>
          </a>
        </div>
      </div>

      <!-- 환경설정 -->
      <div class="menu-group" data-menu="settings">
        <div class="menu-group-header">
          <div class="menu-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
          </div>
          <span class="menu-group-title">환경설정</span>
          <div class="menu-arrow">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
        </div>
        <div class="submenu">
          <a class="submenu-item" href="#" data-page="module-settings">
            <span class="submenu-item-text">학습 모듈 설정</span>
          </a>
          <a class="submenu-item" href="#" data-page="media-manage">
            <span class="submenu-item-text">미디어 관리</span>
          </a>
          <a class="submenu-item" href="#" data-page="popup-settings">
            <span class="submenu-item-text">팝업창 설정</span>
          </a>
          <a class="submenu-item" href="#" data-page="permission-manage">
            <span class="submenu-item-text">권한 관리</span>
          </a>
          <a class="submenu-item" href="#" data-page="notification-manage">
            <span class="submenu-item-text">알림 관리</span>
          </a>
          <a class="submenu-item" href="#" data-page="code-manage">
            <span class="submenu-item-text">코드 관리</span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Floating Submenu -->
  <div class="floating-submenu" id="floatingSubmenu"></div>

  <!-- Main Content -->
  <main class="main-wrapper">
    <div class="fixed-header">
      <div class="page-header">
        <div class="page-header-left">
          <h1 class="page-title">커리큘럼 배정</h1>
          <p class="page-description">분기별 브랜드/학년/레벨에 교재를 배정합니다.</p>
        </div>
      </div>
    </div>

    <div class="content-card">
      <!-- Toolbar -->
      <div class="toolbar">
        <div class="filter-section">
          <div class="search-box">
            <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input type="text" class="search-input" placeholder="교재명으로 검색">
          </div>
          <div class="filter-group">
            <span class="filter-label">연도</span>
            <div class="multi-select" id="yearFilter">
              <div class="multi-select-trigger" onclick="toggleMultiSelect('yearFilter')">
                <span class="multi-select-text">전체</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="multi-select-dropdown">
                <label class="multi-select-option">
                  <input type="checkbox" value="2024" onchange="updateMultiSelectText('yearFilter')">
                  <span>2024</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="2025" onchange="updateMultiSelectText('yearFilter')">
                  <span>2025</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="2026" onchange="updateMultiSelectText('yearFilter')">
                  <span>2026</span>
                </label>
              </div>
            </div>
          </div>
          <div class="filter-group">
            <span class="filter-label">분기</span>
            <div class="multi-select" id="quarterFilter">
              <div class="multi-select-trigger" onclick="toggleMultiSelect('quarterFilter')">
                <span class="multi-select-text">전체</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="multi-select-dropdown">
                <label class="multi-select-option">
                  <input type="checkbox" value="1" onchange="updateMultiSelectText('quarterFilter')">
                  <span>1분기</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="2" onchange="updateMultiSelectText('quarterFilter')">
                  <span>2분기</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="3" onchange="updateMultiSelectText('quarterFilter')">
                  <span>3분기</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="4" onchange="updateMultiSelectText('quarterFilter')">
                  <span>4분기</span>
                </label>
              </div>
            </div>
          </div>
          <div class="filter-group">
            <span class="filter-label">브랜드</span>
            <div class="multi-select" id="brandFilter">
              <div class="multi-select-trigger" onclick="toggleMultiSelect('brandFilter')">
                <span class="multi-select-text">전체</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="multi-select-dropdown">
                <label class="multi-select-option">
                  <input type="checkbox" value="choisun" onchange="updateMultiSelectText('brandFilter')">
                  <span>최선어학원</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="creo" onchange="updateMultiSelectText('brandFilter')">
                  <span>CREO</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="mate-choisun" onchange="updateMultiSelectText('brandFilter')">
                  <span>MATE 최선</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="mate-creo" onchange="updateMultiSelectText('brandFilter')">
                  <span>MATE CREO</span>
                </label>
              </div>
            </div>
          </div>
          <div class="filter-group">
            <span class="filter-label">학년</span>
            <div class="multi-select" id="gradeFilter">
              <div class="multi-select-trigger" onclick="toggleMultiSelect('gradeFilter')">
                <span class="multi-select-text">전체</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="multi-select-dropdown">
                <label class="multi-select-option">
                  <input type="checkbox" value="E4" onchange="updateMultiSelectText('gradeFilter')">
                  <span>E4</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="E5" onchange="updateMultiSelectText('gradeFilter')">
                  <span>E5</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="E6" onchange="updateMultiSelectText('gradeFilter')">
                  <span>E6</span>
                </label>
              </div>
            </div>
          </div>
          <div class="filter-group">
            <span class="filter-label">레벨</span>
            <div class="multi-select" id="levelFilter">
              <div class="multi-select-trigger" onclick="toggleMultiSelect('levelFilter')">
                <span class="multi-select-text">전체</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="multi-select-dropdown">
                <label class="multi-select-option">
                  <input type="checkbox" value="Athena" onchange="updateMultiSelectText('levelFilter')">
                  <span>Athena</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="Apollo" onchange="updateMultiSelectText('levelFilter')">
                  <span>Apollo</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="Artemis" onchange="updateMultiSelectText('levelFilter')">
                  <span>Artemis</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="Hermes" onchange="updateMultiSelectText('levelFilter')">
                  <span>Hermes</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="Startup" onchange="updateMultiSelectText('levelFilter')">
                  <span>Startup</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="Zeus" onchange="updateMultiSelectText('levelFilter')">
                  <span>Zeus</span>
                </label>
              </div>
            </div>
          </div>
          <button class="btn btn-outline" onclick="resetFilters()">필터 초기화</button>
        </div>
        <div class="action-section">
          <span class="selected-count"><strong id="selectedCount">0</strong>개 선택</span>
          <button class="btn btn-primary" id="assignBtn" disabled onclick="openAssignModal()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 5v14M5 12h14"></path>
            </svg>
            교재 배정
          </button>
        </div>
      </div>

      <!-- Table -->
      <div class="table-wrapper">
        <table class="data-table">
          <thead>
            <tr>
              <th class="col-checkbox">
                <div class="checkbox-wrapper">
                  <input type="checkbox" id="selectAll" onchange="toggleSelectAll(this)">
                </div>
              </th>
              <th class="col-quarter">분기</th>
              <th class="col-brand">브랜드</th>
              <th class="col-grade">학년</th>
              <th class="col-level">레벨</th>
              <th class="col-circular">Circular Course 교재</th>
              <th class="col-retention">Retention Course 교재</th>
              <th class="col-modified">최근 수정</th>
              <th class="col-created">등록 정보</th>
              <th class="col-action"></th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <!-- Row 1 -->
            <tr class="clickable" onclick="openAssignModalSingle(this)">
              <td class="col-checkbox" onclick="event.stopPropagation()">
                <div class="checkbox-wrapper">
                  <input type="checkbox" class="row-checkbox" onchange="updateSelectedCount()">
                </div>
              </td>
              <td class="col-quarter">2026년 1분기</td>
              <td class="col-brand">최선어학원</td>
              <td class="col-grade">E5</td>
              <td class="col-level">Athena</td>
              <td class="col-circular">
                <div class="textbook-list">
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    Wonders New Edition 4.1
                  </span>
                </div>
              </td>
              <td class="col-retention">
                <div class="textbook-list">
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    English Coach E5 Athena
                  </span>
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    Wordly Wise 2
                  </span>
                </div>
              </td>
              <td class="col-modified">홍길동, 2026-01-15</td>
              <td class="col-created">김철수, 2026-01-10</td>
              <td class="col-action" onclick="event.stopPropagation()">
                <button class="btn-exception" onclick="openExceptionModal(this)">+예외 캠퍼스</button>
              </td>
            </tr>

            <!-- Row 2 -->
            <tr class="clickable" onclick="openAssignModalSingle(this)">
              <td class="col-checkbox" onclick="event.stopPropagation()">
                <div class="checkbox-wrapper">
                  <input type="checkbox" class="row-checkbox" onchange="updateSelectedCount()">
                </div>
              </td>
              <td class="col-quarter">2026년 1분기</td>
              <td class="col-brand">최선어학원</td>
              <td class="col-grade">E5</td>
              <td class="col-level">Apollo</td>
              <td class="col-circular">
                <div class="textbook-list">
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    Wonders New Edition 4.1
                  </span>
                </div>
              </td>
              <td class="col-retention">
                <div class="textbook-list">
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    English Coach E5 Athena
                  </span>
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    Wordly Wise 2
                  </span>
                </div>
              </td>
              <td class="col-modified">이영희, 2026-01-14</td>
              <td class="col-created">박지민, 2026-01-08</td>
              <td class="col-action" onclick="event.stopPropagation()">
                <button class="btn-exception" onclick="openExceptionModal(this)">+예외 캠퍼스</button>
              </td>
            </tr>

            <!-- Row 3 with Exception -->
            <tr class="clickable" onclick="openAssignModalSingle(this)">
              <td class="col-checkbox" onclick="event.stopPropagation()">
                <div class="checkbox-wrapper">
                  <input type="checkbox" class="row-checkbox" onchange="updateSelectedCount()">
                </div>
              </td>
              <td class="col-quarter">2026년 1분기</td>
              <td class="col-brand">최선어학원</td>
              <td class="col-grade">E6</td>
              <td class="col-level">Songs</td>
              <td class="col-circular">
                <div class="textbook-list">
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    Pathways 3
                  </span>
                </div>
              </td>
              <td class="col-retention">
                <div class="textbook-list">
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    APEX VOCA
                  </span>
                </div>
              </td>
              <td class="col-modified">김철수, 2026-01-13</td>
              <td class="col-created">홍길동, 2026-01-05</td>
              <td class="col-action" onclick="event.stopPropagation()">
                <button class="btn-exception" onclick="openExceptionModal(this)">+예외 캠퍼스</button>
              </td>
            </tr>

            <!-- Exception Row 1 -->
            <tr class="exception-row clickable" onclick="openAssignModalSingle(this)">
              <td class="col-checkbox" onclick="event.stopPropagation()">
                <div class="checkbox-wrapper">
                  <input type="checkbox" class="row-checkbox" onchange="updateSelectedCount()">
                </div>
              </td>
              <td class="col-quarter" colspan="3">
                <div class="exception-indicator">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 18l6-6-6-6"></path>
                  </svg>
                  예외 설정 캠퍼스: <span class="exception-campus">강동하남, 송파, 대치본원</span>
                </div>
              </td>
              <td class="col-level"></td>
              <td class="col-circular">
                <div class="textbook-list">
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    Reading Explorer 4
                  </span>
                </div>
              </td>
              <td class="col-retention">
                <div class="textbook-list">
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    APEX VOCA
                  </span>
                </div>
              </td>
              <td class="col-modified">박지민, 2026-01-12</td>
              <td class="col-created">이영희, 2026-01-10</td>
              <td class="col-action" onclick="event.stopPropagation()">
                <button class="btn-delete" onclick="openDeleteExceptionAlert()">삭제</button>
              </td>
            </tr>

            <!-- Exception Row 2 -->
            <tr class="exception-row clickable" onclick="openAssignModalSingle(this)">
              <td class="col-checkbox" onclick="event.stopPropagation()">
                <div class="checkbox-wrapper">
                  <input type="checkbox" class="row-checkbox" onchange="updateSelectedCount()">
                </div>
              </td>
              <td class="col-quarter" colspan="3">
                <div class="exception-indicator">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 18l6-6-6-6"></path>
                  </svg>
                  예외 설정 캠퍼스: <span class="exception-campus">중계</span>
                </div>
              </td>
              <td class="col-level"></td>
              <td class="col-circular">
                <div class="textbook-list">
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    Reading Explorer 4
                  </span>
                </div>
              </td>
              <td class="col-retention">
                <div class="textbook-list">
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    APEX VOCA
                  </span>
                </div>
              </td>
              <td class="col-modified">김영수, 2026-01-11</td>
              <td class="col-created">홍길동, 2026-01-08</td>
              <td class="col-action" onclick="event.stopPropagation()">
                <button class="btn-delete" onclick="openDeleteExceptionAlert()">삭제</button>
              </td>
            </tr>

            <!-- Row 4 - Unassigned -->
            <tr class="clickable" onclick="openAssignModalSingle(this)">
              <td class="col-checkbox" onclick="event.stopPropagation()">
                <div class="checkbox-wrapper">
                  <input type="checkbox" class="row-checkbox" onchange="updateSelectedCount()">
                </div>
              </td>
              <td class="col-quarter">2026년 1분기</td>
              <td class="col-brand">최선어학원</td>
              <td class="col-grade">E6</td>
              <td class="col-level">Startup</td>
              <td class="col-circular">
                <div class="textbook-list">
                  <span class="textbook-badge unassigned">미배정</span>
                </div>
              </td>
              <td class="col-retention">
                <div class="textbook-list">
                  <span class="textbook-badge unassigned">미배정</span>
                </div>
              </td>
              <td class="col-modified">-</td>
              <td class="col-created">-</td>
              <td class="col-action" onclick="event.stopPropagation()">
                <button class="btn-exception" onclick="openExceptionModal(this)">+예외 캠퍼스</button>
              </td>
            </tr>

            <!-- More rows -->
            <tr class="clickable" onclick="openAssignModalSingle(this)">
              <td class="col-checkbox" onclick="event.stopPropagation()">
                <div class="checkbox-wrapper">
                  <input type="checkbox" class="row-checkbox" onchange="updateSelectedCount()">
                </div>
              </td>
              <td class="col-quarter">2026년 1분기</td>
              <td class="col-brand">최선어학원</td>
              <td class="col-grade">E4</td>
              <td class="col-level">Hercules</td>
              <td class="col-circular">
                <div class="textbook-list">
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    Wonders New Edition 4.1
                  </span>
                </div>
              </td>
              <td class="col-retention">
                <div class="textbook-list">
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    English Coach E5 Athena
                  </span>
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    Wordly Wise 2
                  </span>
                </div>
              </td>
              <td class="col-modified">박지민, 2026-01-10</td>
              <td class="col-created">김영수, 2026-01-03</td>
              <td class="col-action" onclick="event.stopPropagation()">
                <button class="btn-exception" onclick="openExceptionModal(this)">+예외 캠퍼스</button>
              </td>
            </tr>

            <tr class="clickable" onclick="openAssignModalSingle(this)">
              <td class="col-checkbox" onclick="event.stopPropagation()">
                <div class="checkbox-wrapper">
                  <input type="checkbox" class="row-checkbox" onchange="updateSelectedCount()">
                </div>
              </td>
              <td class="col-quarter">2026년 1분기</td>
              <td class="col-brand">최선어학원</td>
              <td class="col-grade">E4</td>
              <td class="col-level">Odysseus</td>
              <td class="col-circular">
                <div class="textbook-list">
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    Wonders New Edition 4.1
                  </span>
                </div>
              </td>
              <td class="col-retention">
                <div class="textbook-list">
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    English Coach E5 Athena
                  </span>
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    Wordly Wise 2
                  </span>
                </div>
              </td>
              <td class="col-modified">홍길동, 2026-01-09</td>
              <td class="col-created">이영희, 2026-01-02</td>
              <td class="col-action" onclick="event.stopPropagation()">
                <button class="btn-exception" onclick="openExceptionModal(this)">+예외 캠퍼스</button>
              </td>
            </tr>

            <tr class="clickable" onclick="openAssignModalSingle(this)">
              <td class="col-checkbox" onclick="event.stopPropagation()">
                <div class="checkbox-wrapper">
                  <input type="checkbox" class="row-checkbox" onchange="updateSelectedCount()">
                </div>
              </td>
              <td class="col-quarter">2026년 1분기</td>
              <td class="col-brand">최선어학원</td>
              <td class="col-grade">E4</td>
              <td class="col-level">Perseus</td>
              <td class="col-circular">
                <div class="textbook-list">
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    Wonders New Edition 4.1
                  </span>
                </div>
              </td>
              <td class="col-retention">
                <div class="textbook-list">
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    English Coach E5 Athena
                  </span>
                  <span class="textbook-badge assigned">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    Wordly Wise 2
                  </span>
                </div>
              </td>
              <td class="col-modified">김철수, 2026-01-08</td>
              <td class="col-created">박지민, 2026-01-01</td>
              <td class="col-action" onclick="event.stopPropagation()">
                <button class="btn-exception" onclick="openExceptionModal(this)">+예외 캠퍼스</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="pagination-wrapper">
        <div class="pagination-info">
          <span>총 <strong>42</strong>개</span>
          <select class="page-size-select">
            <option value="30" selected>30개</option>
            <option value="50">50개</option>
            <option value="80">80개</option>
            <option value="100">100개</option>
            <option value="200">200개</option>
          </select>
        </div>
        <div class="pagination-pages">
          <button class="page-btn" disabled>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <button class="page-btn active">1</button>
          <button class="page-btn">2</button>
          <button class="page-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- Assign Modal -->
  <div class="modal-overlay" id="assignModal" onclick="closeAssignModal()">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title" id="assignModalTitle">교재 배정</h3>
        <button class="modal-close" onclick="closeAssignModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <!-- Target Info -->
        <div class="target-info">
          <div class="target-info-title">배정 대상</div>
          <div class="target-info-content" id="targetInfoContent">
            <span class="target-tag">2026년 1분기</span>
            <span class="target-tag">최선어학원</span>
            <span class="target-tag">E5</span>
            <span class="target-tag">Athena</span>
          </div>
        </div>

        <!-- Circular Course Section -->
        <div class="course-section">
          <div class="course-section-header">
            <span class="course-badge circular">Circular Course</span>
            <span class="course-required"><span class="required">*</span> 1개 이상 선택</span>
          </div>
          <div class="modal-search-wrapper">
            <svg class="modal-search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input type="text" class="modal-search-input" placeholder="교재명으로 검색">
          </div>
          <div class="textbook-selection-list">
            <label class="textbook-selection-item">
              <input type="checkbox" class="circular-checkbox" onchange="updateAssignButton()">
              <div class="textbook-info">
                <div class="textbook-name">Wonders New Edition 4.1</div>
                <div class="textbook-meta">DYB 자체교재 · 4 Week</div>
              </div>
            </label>
            <label class="textbook-selection-item">
              <input type="checkbox" class="circular-checkbox" onchange="updateAssignButton()">
              <div class="textbook-info">
                <div class="textbook-name">Pathways 3</div>
                <div class="textbook-meta">National Geographic · 12 Unit</div>
              </div>
            </label>
            <label class="textbook-selection-item">
              <input type="checkbox" class="circular-checkbox" onchange="updateAssignButton()">
              <div class="textbook-info">
                <div class="textbook-name">Reading Explorer 4</div>
                <div class="textbook-meta">National Geographic · 10 Unit</div>
              </div>
            </label>
            <label class="textbook-selection-item">
              <input type="checkbox" class="circular-checkbox" onchange="updateAssignButton()">
              <div class="textbook-info">
                <div class="textbook-name">Reading Champion 3</div>
                <div class="textbook-meta">YBM · 16 Chapter</div>
              </div>
            </label>
          </div>
          <div class="selected-textbooks" id="selectedCircular">
            <span class="no-selection">선택된 교재가 없습니다</span>
          </div>
        </div>

        <!-- Retention Course Section -->
        <div class="course-section">
          <div class="course-section-header">
            <span class="course-badge retention">Retention Course</span>
            <span class="course-required"><span class="required">*</span> 1개 이상 선택</span>
          </div>
          <div class="modal-search-wrapper">
            <svg class="modal-search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input type="text" class="modal-search-input" placeholder="교재명으로 검색">
          </div>
          <div class="textbook-selection-list">
            <label class="textbook-selection-item">
              <input type="checkbox" class="retention-checkbox" onchange="updateAssignButton()">
              <div class="textbook-info">
                <div class="textbook-name">English Coach E5 Athena</div>
                <div class="textbook-meta">DYB 자체교재 · 14 Module</div>
              </div>
            </label>
            <label class="textbook-selection-item">
              <input type="checkbox" class="retention-checkbox" onchange="updateAssignButton()">
              <div class="textbook-info">
                <div class="textbook-name">Wordly Wise 2</div>
                <div class="textbook-meta">외부교재 · 20 Lesson</div>
              </div>
            </label>
            <label class="textbook-selection-item">
              <input type="checkbox" class="retention-checkbox" onchange="updateAssignButton()">
              <div class="textbook-info">
                <div class="textbook-name">APEX VOCA</div>
                <div class="textbook-meta">DYB 자체교재 · 30 Day</div>
              </div>
            </label>
            <label class="textbook-selection-item">
              <input type="checkbox" class="retention-checkbox" onchange="updateAssignButton()">
              <div class="textbook-info">
                <div class="textbook-name">Word Master 중등 기초</div>
                <div class="textbook-meta">이투스북 · 40 Day</div>
              </div>
            </label>
          </div>
          <div class="selected-textbooks" id="selectedRetention">
            <span class="no-selection">선택된 교재가 없습니다</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn modal-btn-cancel" onclick="closeAssignModal()">취소</button>
        <button class="modal-btn modal-btn-confirm" id="assignConfirmBtn" disabled onclick="confirmAssign()">배정</button>
      </div>
    </div>
  </div>

  <!-- Exception Campus Modal -->
  <div class="modal-overlay" id="exceptionModal" onclick="closeExceptionModal()">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">예외 캠퍼스 설정</h3>
        <button class="modal-close" onclick="closeExceptionModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="target-info">
          <div class="target-info-title">적용 대상</div>
          <div class="target-info-content">
            <span class="target-tag">2026년 1분기</span>
            <span class="target-tag">최선어학원</span>
            <span class="target-tag">E6</span>
            <span class="target-tag">Songs</span>
          </div>
        </div>

        <p style="font-size: 13px; color: var(--font-3); margin-bottom: 16px;">
          이 레벨에서 다른 교재를 사용할 캠퍼스를 선택하세요.<br>
          예외 캠퍼스로 설정하면 별도의 교재를 배정할 수 있습니다.
        </p>

        <div class="modal-search-wrapper">
          <svg class="modal-search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
          <input type="text" class="modal-search-input" placeholder="캠퍼스명으로 검색">
        </div>

        <div class="campus-selection-list">
          <label class="campus-selection-item">
            <input type="checkbox" class="campus-checkbox" data-exception="true" onchange="updateExceptionButton()">
            <span class="campus-name">강동하남</span>
            <span class="exception-badge">예외</span>
          </label>
          <label class="campus-selection-item">
            <input type="checkbox" class="campus-checkbox" data-exception="true" onchange="updateExceptionButton()">
            <span class="campus-name">대치본원</span>
            <span class="exception-badge">예외</span>
          </label>
          <label class="campus-selection-item">
            <input type="checkbox" class="campus-checkbox" data-exception="false" onchange="updateExceptionButton()">
            <span class="campus-name">목동</span>
          </label>
          <label class="campus-selection-item">
            <input type="checkbox" class="campus-checkbox" data-exception="false" onchange="updateExceptionButton()">
            <span class="campus-name">분당</span>
          </label>
          <label class="campus-selection-item">
            <input type="checkbox" class="campus-checkbox" data-exception="true" onchange="updateExceptionButton()">
            <span class="campus-name">송파</span>
            <span class="exception-badge">예외</span>
          </label>
          <label class="campus-selection-item">
            <input type="checkbox" class="campus-checkbox" data-exception="true" onchange="updateExceptionButton()">
            <span class="campus-name">중계</span>
            <span class="exception-badge">예외</span>
          </label>
          <label class="campus-selection-item">
            <input type="checkbox" class="campus-checkbox" data-exception="false" onchange="updateExceptionButton()">
            <span class="campus-name">평촌</span>
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn modal-btn-cancel" onclick="closeExceptionModal()">취소</button>
        <button class="modal-btn modal-btn-confirm" id="exceptionConfirmBtn" disabled onclick="confirmException()">추가 및 교재 배정</button>
      </div>
    </div>
  </div>

  <!-- Assign Confirm Alert -->
  <div class="modal-overlay" id="assignConfirmAlert" onclick="closeAssignConfirmAlert()">
    <div class="modal alert-modal" onclick="event.stopPropagation()">
      <div class="modal-body" style="text-align: center; padding: 32px;">
        <div class="alert-icon warning">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
            <line x1="12" y1="9" x2="12" y2="13"></line>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
        </div>
        <div class="alert-title">교재를 배정하시겠습니까?</div>
        <div class="alert-message" id="alertMessage">
          선택한 <strong>3개</strong> 레벨에 교재가 배정됩니다.<br>
          이 작업은 즉시 적용됩니다.
        </div>
        <div class="alert-footer">
          <button class="modal-btn modal-btn-cancel" onclick="closeAssignConfirmAlert()">취소</button>
          <button class="modal-btn modal-btn-confirm" onclick="applyAssign()">배정</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Reassign Confirm Alert -->
  <div class="modal-overlay" id="reassignConfirmAlert" onclick="closeReassignConfirmAlert()">
    <div class="modal alert-modal" onclick="event.stopPropagation()">
      <div class="modal-body" style="text-align: center; padding: 32px;">
        <div class="alert-icon warning">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
            <line x1="12" y1="9" x2="12" y2="13"></line>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
        </div>
        <div class="alert-title">기존 교재를 변경하시겠습니까?</div>
        <div class="alert-message">
          선택한 레벨에 이미 배정된 교재가 있습니다.<br>
          새로 선택한 교재로 <strong>교체</strong>됩니다.
        </div>
        <div class="alert-footer">
          <button class="modal-btn modal-btn-cancel" onclick="closeReassignConfirmAlert()">취소</button>
          <button class="modal-btn modal-btn-confirm" onclick="applyReassign()">수정 및 재배정</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Exception Confirm Alert (이미 예외 처리된 캠퍼스 포함 시) -->
  <div class="modal-overlay" id="exceptionConfirmAlert" onclick="cancelExceptionConfirmAlert()">
    <div class="modal alert-modal" onclick="event.stopPropagation()">
      <div class="modal-body" style="text-align: center; padding: 32px;">
        <div class="alert-icon warning">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
            <line x1="12" y1="9" x2="12" y2="13"></line>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
        </div>
        <div class="alert-title">이미 예외 처리된 캠퍼스가 포함되어 있습니다</div>
        <div class="alert-message">
          선택한 캠퍼스 중 <strong id="existingExceptionCount">2개</strong>는 이미 다른 교재로 예외 배정되어 있습니다.<br>
          새로운 교재로 다시 배정하시겠습니까?
        </div>
        <div class="alert-footer">
          <button class="modal-btn modal-btn-cancel" onclick="cancelExceptionConfirmAlert()">취소</button>
          <button class="modal-btn modal-btn-confirm" onclick="applyException()">새로 배정</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Exception Alert -->
  <div class="modal-overlay" id="deleteExceptionAlert" onclick="closeDeleteExceptionAlert()">
    <div class="modal alert-modal" onclick="event.stopPropagation()">
      <div class="modal-body" style="text-align: center; padding: 32px;">
        <div class="alert-icon danger">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18"></path>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
        </div>
        <div class="alert-title">예외 설정을 삭제하시겠습니까?</div>
        <div class="alert-message">
          이 캠퍼스들은 상위 레벨에 설정된 교재로<br>
          자동 배정됩니다.
        </div>
        <div class="alert-footer">
          <button class="modal-btn modal-btn-cancel" onclick="closeDeleteExceptionAlert()">취소</button>
          <button class="modal-btn modal-btn-danger" onclick="applyDeleteException()">삭제</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast">
    <svg class="toast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
      <polyline points="22 4 12 14.01 9 11.01"></polyline>
    </svg>
    <span id="toastMessage">교재 배정이 완료되었습니다.</span>
  </div>

  <script>
    // GNB Toggle
    const gnb = document.getElementById('gnb');
    const floatingSubmenu = document.getElementById('floatingSubmenu');
    const menuGroups = document.querySelectorAll('.menu-group');
    
    let currentActivePage = 'curriculum-assign';
    let isOverFloating = false;
    let isEditMode = false;
    let currentExceptionTarget = null; // 예외 캠퍼스 추가 시 대상 행 저장
    
    const menuData = {
      'curriculum': {
        title: '커리큘럼 관리',
        items: [
          { page: 'quarter-settings', text: '분기 설정' },
          { page: 'textbook-register', text: '교재 등록' },
          { page: 'curriculum-assign', text: '커리큘럼 배정' }
        ]
      },
      'contents': {
        title: '콘텐츠 관리',
        items: [
          { page: 'circular-course', text: 'Circular Course' },
          { page: 'retention-course', text: 'Retention Course' }
        ]
      },
      'prompt': {
        title: 'Prompt 관리',
        items: [
          { page: 'content-prompt', text: '콘텐츠 생성 Prompt' },
          { page: 'module-prompt', text: '학습 모듈 Prompt' }
        ]
      },
      'usage': {
        title: '이용 현황',
        items: [
          { page: 'teacher-status', text: '선생님 현황' },
          { page: 'student-status', text: '학생 현황' }
        ]
      },
      'settings': {
        title: '환경설정',
        items: [
          { page: 'module-settings', text: '학습 모듈 설정' },
          { page: 'media-manage', text: '미디어 관리' },
          { page: 'popup-settings', text: '팝업창 설정' },
          { page: 'permission-manage', text: '권한 관리' },
          { page: 'notification-manage', text: '알림 관리' },
          { page: 'code-manage', text: '코드 관리' }
        ]
      }
    };

    // GNB 빈 영역 클릭 시 접기/펼치기
    gnb.addEventListener('click', (e) => {
      if (e.target.closest('.submenu-item') || e.target.closest('.menu-group-header')) return;
      gnb.classList.toggle('collapsed');
      hideFloatingSubmenu();
    });

    // 메뉴 그룹 헤더 클릭/호버 이벤트
    menuGroups.forEach(group => {
      const header = group.querySelector('.menu-group-header');
      const menuKey = group.dataset.menu;

      header.addEventListener('click', (e) => {
        e.stopPropagation();
        if (!gnb.classList.contains('collapsed')) {
          group.classList.toggle('open');
        }
      });

      header.addEventListener('mouseenter', () => {
        if (gnb.classList.contains('collapsed')) {
          showFloatingSubmenu(menuKey, header);
        }
      });

      header.addEventListener('mouseleave', () => {
        if (gnb.classList.contains('collapsed')) {
          setTimeout(() => {
            if (!isOverFloating) hideFloatingSubmenu();
          }, 50);
        }
      });
    });

    floatingSubmenu.addEventListener('mouseenter', () => { isOverFloating = true; });
    floatingSubmenu.addEventListener('mouseleave', () => { isOverFloating = false; hideFloatingSubmenu(); });

    function showFloatingSubmenu(menuKey, headerElement) {
      const data = menuData[menuKey];
      if (!data) return;
      const rect = headerElement.getBoundingClientRect();
      const gnbWidth = gnb.classList.contains('collapsed') ? 56 : 224;
      floatingSubmenu.style.left = `${gnbWidth + 4}px`;
      floatingSubmenu.style.top = `${rect.top}px`;
      let html = `<div class="floating-submenu-title">${data.title}</div>`;
      data.items.forEach(item => {
        const isActive = item.page === currentActivePage ? 'active' : '';
        html += `<a class="floating-item ${isActive}" href="#" data-page="${item.page}"><span class="floating-item-text">${item.text}</span></a>`;
      });
      floatingSubmenu.innerHTML = html;
      floatingSubmenu.classList.add('visible');
    }

    function hideFloatingSubmenu() {
      floatingSubmenu.classList.remove('visible');
    }

    // 필터 초기화
    function resetFilters() {
      // 모든 다중 선택 필터의 체크박스 해제
      document.querySelectorAll('.multi-select input[type="checkbox"]').forEach(cb => {
        cb.checked = false;
      });
      // 텍스트를 "전체"로 리셋
      document.querySelectorAll('.multi-select-text').forEach(el => {
        el.textContent = '전체';
        el.classList.remove('has-selection');
      });
      // 검색 입력 초기화
      document.querySelector('.search-input').value = '';
    }

    // 다중 선택 드롭다운 토글
    function toggleMultiSelect(id) {
      const multiSelect = document.getElementById(id);
      const isOpen = multiSelect.classList.contains('open');
      
      // 다른 열려있는 드롭다운 닫기
      document.querySelectorAll('.multi-select.open').forEach(el => {
        el.classList.remove('open');
      });
      
      if (!isOpen) {
        multiSelect.classList.add('open');
      }
    }

    // 다중 선택 텍스트 업데이트
    function updateMultiSelectText(id) {
      const multiSelect = document.getElementById(id);
      const checkboxes = multiSelect.querySelectorAll('input[type="checkbox"]:checked');
      const textEl = multiSelect.querySelector('.multi-select-text');
      
      if (checkboxes.length === 0) {
        textEl.textContent = '전체';
        textEl.classList.remove('has-selection');
      } else if (checkboxes.length === 1) {
        const label = checkboxes[0].closest('.multi-select-option').querySelector('span').textContent;
        textEl.textContent = label;
        textEl.classList.add('has-selection');
      } else {
        textEl.textContent = `${checkboxes.length}개 선택`;
        textEl.classList.add('has-selection');
      }
    }

    // 외부 클릭 시 드롭다운 닫기
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.multi-select')) {
        document.querySelectorAll('.multi-select.open').forEach(el => {
          el.classList.remove('open');
        });
      }
    });

    // Table Selection
    function toggleSelectAll(checkbox) {
      const rowCheckboxes = document.querySelectorAll('.row-checkbox');
      rowCheckboxes.forEach(cb => cb.checked = checkbox.checked);
      updateSelectedCount();
    }

    function updateSelectedCount() {
      const checked = document.querySelectorAll('.row-checkbox:checked').length;
      document.getElementById('selectedCount').textContent = checked;
      document.getElementById('assignBtn').disabled = checked === 0;
      
      const checkedRows = document.querySelectorAll('.row-checkbox:checked');
      let hasExisting = false;
      checkedRows.forEach(cb => {
        const row = cb.closest('tr');
        const badges = row.querySelectorAll('.textbook-badge.assigned');
        if (badges.length > 0) hasExisting = true;
      });
      
      const btn = document.getElementById('assignBtn');
      if (hasExisting && checked > 0) {
        btn.innerHTML = '수정 및 재배정';
      } else {
        btn.innerHTML = `
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12h14"></path>
          </svg>
          교재 배정
        `;
      }
    }

    function openAssignModal() {
      const checked = document.querySelectorAll('.row-checkbox:checked').length;
      if (checked === 0) return;
      
      const checkedRows = document.querySelectorAll('.row-checkbox:checked');
      let hasExisting = false;
      checkedRows.forEach(cb => {
        const row = cb.closest('tr');
        const badges = row.querySelectorAll('.textbook-badge.assigned');
        if (badges.length > 0) hasExisting = true;
      });
      
      isEditMode = hasExisting;
      
      document.getElementById('assignModalTitle').textContent = hasExisting ? '교재 수정 및 재배정' : '교재 배정';
      document.getElementById('assignConfirmBtn').textContent = hasExisting ? '수정 및 재배정' : '배정';
      document.getElementById('targetInfoContent').innerHTML = `<span class="target-tag">${checked}개 레벨 선택됨</span>`;
      
      document.getElementById('assignModal').classList.add('show');
    }

    function openAssignModalSingle(row) {
      const quarter = row.querySelector('.col-quarter')?.textContent || '';
      const brand = row.querySelector('.col-brand')?.textContent || '';
      const grade = row.querySelector('.col-grade')?.textContent || '';
      const level = row.querySelector('.col-level')?.textContent || '';
      
      const isException = row.classList.contains('exception-row');
      const hasExisting = row.querySelectorAll('.textbook-badge.assigned').length > 0;
      
      isEditMode = hasExisting;
      
      document.getElementById('assignModalTitle').textContent = hasExisting ? '교재 수정 및 재배정' : '교재 배정';
      document.getElementById('assignConfirmBtn').textContent = hasExisting ? '수정 및 재배정' : '배정';
      
      if (isException) {
        const campus = row.querySelector('.exception-campus')?.textContent || '';
        document.getElementById('targetInfoContent').innerHTML = `
          <span class="target-tag">예외 캠퍼스: ${campus}</span>
        `;
      } else {
        document.getElementById('targetInfoContent').innerHTML = `
          <span class="target-tag">${quarter}</span>
          <span class="target-tag">${brand}</span>
          <span class="target-tag">${grade}</span>
          <span class="target-tag">${level}</span>
        `;
      }
      
      document.getElementById('assignModal').classList.add('show');
    }
    
    // 예외 캠퍼스 추가 후 교재 배정 팝업 열기
    function openAssignModalForException() {
      isEditMode = false;
      
      const data = window.exceptionData;
      
      // 이미 예외 처리된 캠퍼스가 포함되어 있으면 수정 모드
      isEditMode = data.hasExisting;
      
      if (isEditMode) {
        document.getElementById('assignModalTitle').textContent = '교재 수정 및 재배정(예외 캠퍼스)';
        document.getElementById('assignConfirmBtn').textContent = '수정 및 재배정';
      } else {
        document.getElementById('assignModalTitle').textContent = '교재 배정(예외 캠퍼스)';
        document.getElementById('assignConfirmBtn').textContent = '배정';
      }
      
      // 분기/브랜드/학년/레벨 + 예외 캠퍼스 표시
      document.getElementById('targetInfoContent').innerHTML = `
        ${data.targetInfo}
        <span class="target-tag" style="background: #FEF3C7; color: #B45309; border-color: #FCD34D;">예외 캠퍼스: ${data.campusNames}</span>
      `;
      
      // 체크박스 초기화
      document.querySelectorAll('.circular-checkbox, .retention-checkbox').forEach(cb => cb.checked = false);
      updateAssignButton();
      
      document.getElementById('assignModal').classList.add('show');
    }

    function closeAssignModal() {
      document.getElementById('assignModal').classList.remove('show');
      document.querySelectorAll('.circular-checkbox, .retention-checkbox').forEach(cb => cb.checked = false);
      updateAssignButton();
    }

    function updateAssignButton() {
      const circularChecked = document.querySelectorAll('.circular-checkbox:checked').length;
      const retentionChecked = document.querySelectorAll('.retention-checkbox:checked').length;
      
      document.getElementById('assignConfirmBtn').disabled = circularChecked === 0 || retentionChecked === 0;
      
      updateSelectedDisplay('circular');
      updateSelectedDisplay('retention');
    }

    function updateSelectedDisplay(type) {
      const container = document.getElementById(`selected${type.charAt(0).toUpperCase() + type.slice(1)}`);
      const checkboxes = document.querySelectorAll(`.${type}-checkbox:checked`);
      
      if (checkboxes.length === 0) {
        container.innerHTML = '<span class="no-selection">선택된 교재가 없습니다</span>';
      } else {
        let html = '';
        checkboxes.forEach(cb => {
          const name = cb.closest('.textbook-selection-item').querySelector('.textbook-name').textContent;
          html += `
            <span class="selected-textbook-tag">
              ${name}
              <button type="button" onclick="event.preventDefault(); event.stopPropagation();">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </span>
          `;
        });
        container.innerHTML = html;
      }
    }

    function confirmAssign() {
      closeAssignModal();
      if (isEditMode) {
        // 이미 교재가 배정되어 있는 경우 → Alert 표시
        document.getElementById('reassignConfirmAlert').classList.add('show');
      } else {
        // 미배정 상태에서 새로 배정하는 경우 → Alert 없이 바로 적용
        applyAssign();
      }
    }

    function closeAssignConfirmAlert() {
      document.getElementById('assignConfirmAlert').classList.remove('show');
    }

    function closeReassignConfirmAlert() {
      document.getElementById('reassignConfirmAlert').classList.remove('show');
    }

    function applyAssign() {
      closeAssignConfirmAlert();
      // 배정 대상 정보 가져오기
      const targetInfo = document.getElementById('targetInfoContent').textContent.trim();
      showToast(`${targetInfo}에 교재 배정이 완료되었습니다.`);
    }

    function applyReassign() {
      closeReassignConfirmAlert();
      // 배정 대상 정보 가져오기
      const targetInfo = document.getElementById('targetInfoContent').textContent.trim();
      showToast(`${targetInfo}에 교재가 재배정되었습니다.`);
    }

    // Toast 표시 함수
    function showToast(message) {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toastMessage');
      toastMessage.textContent = message;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Exception Modal
    function openExceptionModal(btn) {
      // 현재 행 정보 저장
      const row = btn.closest('tr');
      currentExceptionTarget = row;
      
      // 대상 정보 업데이트
      const quarter = row.querySelector('.col-quarter')?.textContent || '';
      const brand = row.querySelector('.col-brand')?.textContent || '';
      const grade = row.querySelector('.col-grade')?.textContent || '';
      const level = row.querySelector('.col-level')?.textContent || '';
      
      document.querySelector('#exceptionModal .target-info-content').innerHTML = `
        <span class="target-tag">${quarter}</span>
        <span class="target-tag">${brand}</span>
        <span class="target-tag">${grade}</span>
        <span class="target-tag">${level}</span>
      `;
      
      document.getElementById('exceptionModal').classList.add('show');
    }

    function closeExceptionModal() {
      document.getElementById('exceptionModal').classList.remove('show');
      document.querySelectorAll('.campus-checkbox').forEach(cb => cb.checked = false);
      updateExceptionButton();
    }

    function updateExceptionButton() {
      const checked = document.querySelectorAll('.campus-checkbox:checked').length;
      document.getElementById('exceptionConfirmBtn').disabled = checked === 0;
    }

    function confirmException() {
      const checkedCampuses = document.querySelectorAll('.campus-checkbox:checked');
      const campusNames = Array.from(checkedCampuses).map(cb => 
        cb.closest('.campus-selection-item').querySelector('.campus-name').textContent
      ).join(', ');
      
      // 이미 예외 처리된 캠퍼스 체크
      const existingExceptions = Array.from(checkedCampuses).filter(cb => 
        cb.dataset.exception === 'true'
      );
      
      // 대상 정보 저장 (분기/브랜드/학년/레벨)
      const targetInfo = document.querySelector('#exceptionModal .target-info-content').innerHTML;
      
      // 데이터 저장
      window.exceptionData = {
        campusNames: campusNames,
        targetInfo: targetInfo,
        hasExisting: existingExceptions.length > 0,
        existingCount: existingExceptions.length
      };
      
      closeExceptionModal();
      
      if (existingExceptions.length > 0) {
        // 이미 예외 처리된 캠퍼스가 포함된 경우 → Alert 표시
        document.getElementById('existingExceptionCount').textContent = existingExceptions.length + '개';
        document.getElementById('exceptionConfirmAlert').classList.add('show');
      } else {
        // 새로운 캠퍼스만 선택한 경우 → 바로 교재 배정 팝업
        openAssignModalForException();
      }
    }

    function closeExceptionConfirmAlert() {
      document.getElementById('exceptionConfirmAlert').classList.remove('show');
    }
    
    function cancelExceptionConfirmAlert() {
      document.getElementById('exceptionConfirmAlert').classList.remove('show');
      // 예외 캠퍼스 선택 팝업으로 돌아가기
      document.getElementById('exceptionModal').classList.add('show');
    }

    function applyException() {
      closeExceptionConfirmAlert();
      
      // 바로 교재 배정 팝업 열기
      openAssignModalForException();
    }

    // Delete Exception
    function openDeleteExceptionAlert() {
      document.getElementById('deleteExceptionAlert').classList.add('show');
    }

    function closeDeleteExceptionAlert() {
      document.getElementById('deleteExceptionAlert').classList.remove('show');
    }

    function applyDeleteException() {
      closeDeleteExceptionAlert();
      showToast('예외 캠퍼스 설정이 삭제되었습니다.');
    }
  </script>
</body>
</html>
